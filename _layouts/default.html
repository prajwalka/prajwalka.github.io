<!DOCTYPE html>
<html>
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-L2NHRT70CW"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-L2NHRT70CW');
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ page.title }} | {{ site.title }}</title>
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css" /> 
  <link rel="stylesheet" href="/assets/style.css?v=2">
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <link href="https://fonts.cdnfonts.com/css/computer-modern" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  {% include header.html %}
  <main>
    {{ content }}
  </main>
  {% include footer.html %}
<script src="/assets/script.js"></script>
<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>

<script> 
  function resetAllVideos(swiper) { 
    swiper.el.querySelectorAll('video').forEach(v => { 
      v.pause(); 
      try { v.currentTime = 0; } 
      catch (_) {} 
    }); 
  } 

  function startActiveSlideVideos(swiper) { 
    const activeSlide = swiper.slides[swiper.activeIndex]; 
    if (!activeSlide) return; 
    activeSlide.querySelectorAll('video').forEach(v => { 
      const p = v.play(); 
      if (p && typeof p.then === 'function') { 
        p.catch(() => { 
          /* autoplay may be blocked if not muted */ 
        }); 
      } 
    }); 
  } 

  function setupVisibilityObserver(swiper) { 
    const io = new IntersectionObserver((entries) => { 
      entries.forEach((entry) => { 
        if (entry.target !== swiper.el) return; 
        if (entry.isIntersecting) { 
          resetAllVideos(swiper); 
          startActiveSlideVideos(swiper); 
        } 
        else { 
          swiper.el.querySelectorAll('video').forEach(v => v.pause()); 
        } 
      }); 
    }, 
    { threshold: 0.2 }); 
    io.observe(swiper.el); 
  } 

  var swiper = new Swiper(".videoSwiper", { 
    loop: true, autoplay: { 
      delay: 8000, disableOnInteraction: false, 
    }, 
    navigation: { 
      nextEl: ".swiper-button-next", prevEl: ".swiper-button-prev", 
    }, 
    pagination: { 
      el: ".swiper-pagination", clickable: true, 
    }, 
    on: { 
      init: function () { 
        resetAllVideos(this); 
        startActiveSlideVideos(this); 
        setupVisibilityObserver(this); 
      }, 
      slideChangeTransitionStart: function () { r
        esetAllVideos(this); 
        startActiveSlideVideos(this); 
      } 
    } 
  }); 
</script>

<script>
  window.addEventListener("load", () => {
    const videos = document.querySelectorAll(".scale-video");

    videos.forEach(video => {
      const setPlaybackRate = () => {
        if (video.duration && video.duration > 0) {
          const rate = video.duration / 8; // 8 seconds per video
          video.playbackRate = rate;
          console.log(`Set playback rate for ${video.src} to ${rate}`);
        } else {
          console.warn(`Duration not available yet for ${video.src}`);
        }
      };

      // Try once immediately
      setPlaybackRate();

      // Try again on loadeddata (if metadata wasn't ready yet)
      video.addEventListener("loadedmetadata", setPlaybackRate);
    });
  });
</script>

</body>
</html>
